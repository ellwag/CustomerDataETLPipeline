

2023-12-10 16:13:18:ERROR:An error occurred while executing SQL: (psycopg2.errors.DuplicateTable) relation "idx_customer_id" already exists

[SQL: CREATE INDEX idx_customer_id ON staging_customer_data (customer_id);]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-12-10 16:13:18:ERROR:Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DuplicateTable: relation "idx_customer_id" already exists


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/etl.py", line 68, in execute_sql
    conn.execute(text(sql))
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DuplicateTable) relation "idx_customer_id" already exists

[SQL: CREATE INDEX idx_customer_id ON staging_customer_data (customer_id);]
(Background on this error at: https://sqlalche.me/e/20/f405)

2023-12-10 16:13:18:ERROR:An error occurred while executing SQL: (psycopg2.errors.DuplicateTable) relation "customers" already exists

[SQL: 
        CREATE TABLE customers AS
        SELECT DISTINCT customer_id, age, gender, subscription_status
        FROM staging_customer_data;
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-12-10 16:13:18:ERROR:Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DuplicateTable: relation "customers" already exists


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/etl.py", line 68, in execute_sql
    conn.execute(text(sql))
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DuplicateTable) relation "customers" already exists

[SQL: 
        CREATE TABLE customers AS
        SELECT DISTINCT customer_id, age, gender, subscription_status
        FROM staging_customer_data;
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

2023-12-10 16:13:18:ERROR:An error occurred while executing SQL: (psycopg2.errors.DuplicateTable) relation "purchases" already exists

[SQL: 
        CREATE TABLE purchases AS
        SELECT customer_id, item_purchased, purchase_amount, location, review_rating
        FROM staging_customer_data;
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-12-10 16:13:18:ERROR:Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DuplicateTable: relation "purchases" already exists


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/etl.py", line 68, in execute_sql
    conn.execute(text(sql))
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DuplicateTable) relation "purchases" already exists

[SQL: 
        CREATE TABLE purchases AS
        SELECT customer_id, item_purchased, purchase_amount, location, review_rating
        FROM staging_customer_data;
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

2023-12-10 16:13:18:ERROR:An error occurred while executing SQL: (psycopg2.errors.DuplicateTable) relation "products" already exists

[SQL: 
        CREATE TABLE products AS
        SELECT DISTINCT item_purchased, category, size, color, season
        FROM staging_customer_data;
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2023-12-10 16:13:18:ERROR:Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DuplicateTable: relation "products" already exists


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/etl.py", line 68, in execute_sql
    conn.execute(text(sql))
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/Elliot/Desktop/ETL/venv/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DuplicateTable) relation "products" already exists

[SQL: 
        CREATE TABLE products AS
        SELECT DISTINCT item_purchased, category, size, color, season
        FROM staging_customer_data;
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)

2023-12-10 16:23:57:ERROR:An error occurred: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "shoppingpipeline" does not exist

(Background on this error at: https://sqlalche.me/e/14/e3q8)
2023-12-10 16:26:43:ERROR:An error occurred while executing SQL: (builtins.TypeError) Not a boolean value: 'Yes'
[SQL: INSERT INTO staging_customer_data (customer_id, category, age, gender, location, color, size, season, item_purchased, purchase_amount, review_rating, subscription_status, payment_method, shipping_type, discount_applied, promo_code_used, previous_purchase, preferred_payment_method, frequency_of_purchase) VALUES (%(customer_id)s, %(category)s, %(age)s, %(gender)s, %(location)s, %(color)s, %(size)s, %(season)s, %(item_purchased)s, %(purchase_amount)s, %(review_rating)s, %(subscription_status)s, %(payment_method)s, %(shipping_type)s, %(discount_applied)s, %(promo_code_used)s, %(previous_purchase)s, %(preferred_payment_method)s, %(frequency_of_purchase)s) ON CONFLICT (customer_id) DO UPDATE SET category = excluded.category, age = excluded.age, gender = excluded.gender, location = excluded.location, color = excluded.color, size = excluded.size, season = excluded.season, item_purchased = excluded.item_purchased, purchase_amount = excluded.purchase_amount, review_rating = excluded.review_rating, subscription_status = excluded.subscription_status, payment_method = excluded.payment_method, shipping_type = excluded.shipping_type, discount_applied = excluded.discount_applied, promo_code_used = excluded.promo_code_used, previous_purchase = excluded.previous_purchase, preferred_payment_method = excluded.preferred_payment_method, frequency_of_purchase = excluded.frequency_of_purchase]
2023-12-10 16:26:43:ERROR:Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1800, in _execute_context
    context = constructor(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 1120, in _init_compiled
    param = {
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 1121, in <dictcomp>
    key: processors[key](compiled_params[key])
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/sqltypes.py", line 2000, in process
    value = _strict_as_bool(value)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/sqltypes.py", line 1975, in _strict_as_bool
    raise TypeError("Not a boolean value: %r" % (value,))
TypeError: Not a boolean value: 'Yes'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/etl.py", line 82, in load_to_staging
    conn.execute(on_conflict_stmt)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1380, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 333, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1572, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1806, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2124, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1800, in _execute_context
    context = constructor(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 1120, in _init_compiled
    param = {
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 1121, in <dictcomp>
    key: processors[key](compiled_params[key])
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/sqltypes.py", line 2000, in process
    value = _strict_as_bool(value)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/sqltypes.py", line 1975, in _strict_as_bool
    raise TypeError("Not a boolean value: %r" % (value,))
sqlalchemy.exc.StatementError: (builtins.TypeError) Not a boolean value: 'Yes'
[SQL: INSERT INTO staging_customer_data (customer_id, category, age, gender, location, color, size, season, item_purchased, purchase_amount, review_rating, subscription_status, payment_method, shipping_type, discount_applied, promo_code_used, previous_purchase, preferred_payment_method, frequency_of_purchase) VALUES (%(customer_id)s, %(category)s, %(age)s, %(gender)s, %(location)s, %(color)s, %(size)s, %(season)s, %(item_purchased)s, %(purchase_amount)s, %(review_rating)s, %(subscription_status)s, %(payment_method)s, %(shipping_type)s, %(discount_applied)s, %(promo_code_used)s, %(previous_purchase)s, %(preferred_payment_method)s, %(frequency_of_purchase)s) ON CONFLICT (customer_id) DO UPDATE SET category = excluded.category, age = excluded.age, gender = excluded.gender, location = excluded.location, color = excluded.color, size = excluded.size, season = excluded.season, item_purchased = excluded.item_purchased, purchase_amount = excluded.purchase_amount, review_rating = excluded.review_rating, subscription_status = excluded.subscription_status, payment_method = excluded.payment_method, shipping_type = excluded.shipping_type, discount_applied = excluded.discount_applied, promo_code_used = excluded.promo_code_used, previous_purchase = excluded.previous_purchase, preferred_payment_method = excluded.preferred_payment_method, frequency_of_purchase = excluded.frequency_of_purchase]

2023-12-10 16:37:52:ERROR:An error occurred while executing SQL: subject table for an INSERT, UPDATE or DELETE expected, got 'staging_customer_data'.
2023-12-10 16:37:52:ERROR:Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/etl.py", line 52, in load_to_staging
    stmt = insert(table_schema).values(**record)
  File "<string>", line 2, in insert
  File "<string>", line 2, in __init__
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/deprecations.py", line 309, in warned
    return fn(*args, **kwargs)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/dml.py", line 1029, in __init__
    super(Insert, self).__init__(table, values, prefixes)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/dml.py", line 615, in __init__
    self.table = coercions.expect(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/coercions.py", line 188, in expect
    resolved = impl._literal_coercion(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/coercions.py", line 371, in _literal_coercion
    self._raise_for_expected(element, argname)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/coercions.py", line 437, in _raise_for_expected
    return super(_SelectIsNotFrom, self)._raise_for_expected(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/coercions.py", line 283, in _raise_for_expected
    util.raise_(exc.ArgumentError(msg, code=code), replace_context=err)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
sqlalchemy.exc.ArgumentError: subject table for an INSERT, UPDATE or DELETE expected, got 'staging_customer_data'.

2023-12-10 17:57:15:ERROR:An error occurred while executing SQL: (psycopg2.errors.DuplicateTable) relation "idx_customer_id" already exists

[SQL: CREATE INDEX idx_customer_id ON staging_customer_data (customer_id);]
(Background on this error at: https://sqlalche.me/e/14/f405)
2023-12-10 17:57:15:ERROR:Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1900, in _execute_context
    self.dialect.do_execute(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.DuplicateTable: relation "idx_customer_id" already exists


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/Elliot/Desktop/ETL/etl.py", line 70, in execute_sql
    conn.execute(text(sql))
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1380, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 333, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1572, in _execute_clauseelement
    ret = self._execute_context(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1943, in _execute_context
    self._handle_dbapi_exception(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2124, in _handle_dbapi_exception
    util.raise_(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1900, in _execute_context
    self.dialect.do_execute(
  File "/opt/anaconda3/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DuplicateTable) relation "idx_customer_id" already exists

[SQL: CREATE INDEX idx_customer_id ON staging_customer_data (customer_id);]
(Background on this error at: https://sqlalche.me/e/14/f405)

